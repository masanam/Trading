<div class="col-lg-12">
  <div class="box">
    <div class="box-header with-border">
      <h1 class="box-title" style="font-size: 25px">Orders</h1>

      <div class="box-tools pull-right">
        <button ui-sref="order.create" class="btn btn-primary">+ Create New Order</button>
      </div>
    </div>
    <div class="box-body no-padding" ng-init="find();">
      <div class="box-body">
        <div class="box-tools btn-group" ng-init="browse.possession = 'my'">
          <label class="btn btn-default" ng-model="browse.possession" uib-btn-radio="'my'">My Orders</label>
          <label class="btn btn-default" ng-model="browse.possession" uib-btn-radio="'subordinates'">Subordinates</label>
          <label class="btn btn-default" ng-model="browse.possession" uib-btn-radio="'associated'">Associated</label>
        </div>

        <div class="box-tools btn-group" ng-init="browse.status = 'p'">
          <label class="btn btn-default" ng-model="browse.status" uib-btn-radio="'d'">Draft</label>
          <label class="btn btn-default" ng-model="browse.status" uib-btn-radio="'p'">Pending</label>
          <label class="btn btn-default" ng-model="browse.status" uib-btn-radio="'a'">Approved</label>
          <label class="btn btn-default" ng-model="browse.status" uib-btn-radio="'f'">Finalized</label>
          <label class="btn btn-default" ng-model="browse.status" uib-btn-radio="'x'">Deleted</label>
        </div>

        <div class="box-tools pull-right">
          ... Or leads?
          <span class="btn-group">
            <button ui-sref="buy-order.index" class="btn btn-primary">+ Buy</button>
            <button ui-sref="sell-order.index" class="btn btn-primary">+ Sell</button>
          </span>
        </div>
      </div>
      
      <table st-table="orders" st-safe-src="orderCollection" class="table table-striped">
        <thead>
          <tr>
              <th colspan="9"><input st-search="" class="form-control" placeholder="global search ..." type="text"/></th>
          </tr>
          <tr>
            <th st-sort="id">#</th>
            <th st-sort="user_id">Trader</th>
            <th st-sort="status">Status</th>
            <th st-sort="created_at">Created At</th>
            <th st-sort="updated_at">Updated At</th>
            <th>Approval Status</th>
            <th></th>
          </tr>
        </thead>

        <tbody>
          <tr ng-repeat="order in orders">
            <td>{{ order.id }}</td>
            <td>{{ order.trader.name }}</td>
            <td ng-if="order.status === 'o'">Open</td>
            <td ng-if="order.status === 'd'">Draft</td>
            <td ng-if="order.status === 'x'">Deleted</td>
            <td ng-if="order.status === 'p'">Pending</td>
            <td ng-if="order.status === 'f'">Finalized</td>
            <td>{{ order.created_at | date:'d/M/yy' }}</td>
            <td>{{ order.updated_at | date:'d/M/yy' }}</td>
            <td>
              <div ng-repeat="app in order.approvals.slice().reverse()">
                {{ app.name | firstWord }} [{{ app.status }}]
              </div>
            </td>
            <td>
              <a ui-sref="order.view({ id: order.id })"><i class="glyphicon glyphicon-eye-open"></i></a>
              <a ng-click="remove(order)"><i class="glyphicon glyphicon-trash"></i></a>
            </td>
          </tr>
          <tr ng-if="orders.length == 0">
            <td colspan="6" class="text-center">No data available</td>
          </tr>
        </tbody>
      </table>

      <div class="callout callout-warning text-center" ng-if="orders.$resolved && !orders.length">
        No orders yet, why don't you <a ui-sref="order.create">create one</a>?
      </div>  
    </div>
  </div>
</div>